{% extends './basic.html' %} {% load static %} {% block title %} Quotation {%endblock title%}
{%block css %} {%endblock css %} {% block body %}

<style>
  #mod_date {
    color: red !important;
  }
  #err,
  #chkdates {
    display: none;
  }

  #loader-form {
    height: 100vh;
    width: 100vw;
    background: rgba(255, 255, 255, 0.7);
    display: none;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 999;
  }
  #loader-form h2 {
    animation: fadeloop 0.75s infinite;
    opacity: 0;
  }
  #prev-down {
    display: none;
  }

  @keyframes fadeloop {
    0% {
      opacity: 0;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }
</style>

<!-- Loader -->

<div id="loader-form">
  <div class="mainload h-100 w-100 d-flex align-items-center justify-content-center">
    <h2>Processing...</h2>
  </div>
</div>

<!-- Loader End -->

<!-- Page Wrapper -->
<div id="wrapper">
  {% comment %}
  <!-- Sidebar -->
  <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
    <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/">
      <div class="sidebar-brand-icon rotate-n-15">
        <i class="fas fa-laugh-wink"></i>
      </div>
      <div class="sidebar-brand-text mx-3">Dashboard</div>
    </a>

    <!-- Divider -->
    <hr class="sidebar-divider my-0" />

    <!-- Nav Item - Dashboard -->
    <li class="nav-item active">
      <a class="nav-link" href="/dashboard/malt">
        <i class="fas fa-fw fa-tachometer-alt"></i>
        <span>Malt</span></a
      >
    </li>
    <li class="nav-item active">
      <a class="nav-link" href="/dashboard/hops">
        <i class="fas fa-fw fa-tachometer-alt"></i>
        <span>Hops</span></a
      >
    </li>
    <li class="nav-item active">
      <a class="nav-link" href="/dashboard/yeast">
        <i class="fas fa-fw fa-tachometer-alt"></i>
        <span>Yeast</span></a
      >
    </li>
    <!-- Divider -->
    <hr class="sidebar-divider d-none d-md-block" />
  </ul>
  {% endcomment %}

  <!-- End of Sidebar -->

  <!-- Content Wrapper -->
  <div id="content-wrapper" class="d-flex flex-column">
    <!-- Main Content -->
    <div id="content">
      <!-- Topbar -->
      <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
        <!-- Sidebar Toggle (Topbar) -->
        <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
          <i class="fa fa-bars"></i>
        </button>
      </nav>

      <div class="container p-3">
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
          <h1 class="h3 mb-0 text-gray-800">Create Quotation</h1>
        </div>
        <form onsubmit="handlesubmit(event)" id="quote">
          {% csrf_token %}
          <div class="row">
            <!-- from date to date -->
            <div class="col-6">
              <div class="form-group">
                <label for="date_frm">Date From</label>

                <input
                  type="date"
                  id="date_frm"
                  name="date_frm"
                  class="form-control"
                  onchange="checkDateRange()"
                />
                <!-- <select
                  class="form-select form-control"
                  aria-label="date_frm"
                  id="date_frm"
                  name="date_frm"
                >
                  {%for available_dates in available_dates%}
                  <option value=" {{available_dates.date_applicable_from}}">
                    {{available_dates.date_applicable_from}}
                  </option>
                  {%endfor%}
                </select> -->
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="date_to">Date To</label>
                <input
                  type="date"
                  id="date_to"
                  name="date_to"
                  class="form-control"
                  onchange="checkDateRange()"
                />
                <!-- <select
                  class="form-select form-control"
                  aria-label="date_to"
                  id="date_to"
                  name="date_to"
                >
                  {%for available_dates in available_dates%}
                  <option value=" {{available_dates.date_applicable_from}}">
                    {{available_dates.date_applicable_from}}
                  </option>
                  {%endfor%}
                </select> -->
              </div>
            </div>
            <div class="col-12">
              <p class="bg-warning text-dark px-3 rounded" id="chkdates">
                Selected Dates are not Available
              </p>
            </div>

            <div class="col-6">
              <div class="form-group">
                <label for="country">Country</label>
                <select
                  class="form-select form-control"
                  aria-label="country"
                  id="country"
                  name="country"
                >
                  <option value="000">-Select Country-</option>
                </select>
              </div>
            </div>

            <div class="col-6">
              <div class="form-group">
                <label for="area">Area</label>
                <select class="form-select form-control" aria-label="area" id="state" name="state">
                  <option value="000">-Select Area-</option>
                </select>
              </div>
            </div>

            <!-- Hotel name -->
            <div class="col-12">
              <div class="form-group">
                <label for="hotel_name">Hotel Name</label>
                <select
                  class="form-select form-control"
                  aria-label="hotel_name"
                  id="hotel_name"
                  name="hotel_name"
                >
                  <option value="000">-Select Hotel-</option>
                  <!--                  <option value="{{hotel_name.id}}">{{hotel_name.hotel_name}}</option>-->
                </select>
              </div>
            </div>

            <!-- Residents and non-residents counts -->
            <div class="col-6">
              <div class="form-group">
                <label for="adult_res">Number adult resident: </label>
                <input
                  type="number"
                  class="form-control"
                  id="adult_res"
                  placeholder="Number adult resident"
                  name="adult_res"
                  value="0"
                />
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="adult_nonres">Number adult Non-Resident: </label>
                <input
                  type="number"
                  class="form-control"
                  id="adult_nonres"
                  placeholder="Number Adult Non-Resident"
                  name="adult_nonres"
                  value="0"
                />
              </div>
            </div>
            <!-- No. Child Residents and No.of child non residents -->
            <div class="col-6">
              <div class="form-group">
                <label for="child_res">Number Child Resident: </label>
                <input
                  type="number"
                  class="form-control"
                  id="child_res"
                  placeholder="Number Child Resident"
                  name="child_res"
                  value="0"
                />
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="child_nonres">Number Child Non-Resident: </label>
                <input
                  type="number"
                  class="form-control"
                  id="child_nonres"
                  placeholder="Number Child Non-Resident"
                  name="child_nonres"
                  value="0"
                />
              </div>
            </div>

            <div class="col-12">
              <h4>Room Request</h4>
            </div>
            <!-- Rooms Requests -->
            <div id="roomContainer">
              <div class="room-request row">
                <div class="col-6">
                  <div class="form-group">
                    <label for="package_type">Package Type</label>
                    <select
                      class="form-select form-control"
                      aria-label="package_type"
                      id="package_type"
                      name="package_type"
                    >
                      {%for package_type in room_dict.package_type%}
                      <option value="{{package_type}}">{{package_type}}</option>
                      {%endfor%}
                    </select>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="room_category">Room Category</label>
                    <select
                      class="form-select form-control"
                      aria-label="room_category"
                      id="room_category"
                      name="room_category"
                    >
                      {%for room_category in room_dict.room_category%}
                      <option value="{{room_category}}">{{room_category}}</option>
                      {%endfor%}
                    </select>
                  </div>
                </div>

                <!-- Room type and room count -->
                <div class="col-6">
                  <div class="form-group">
                    <label for="room_type">Room Type</label>
                    <select
                      class="form-select form-control"
                      aria-label="room_type"
                      id="room_type"
                      name="room_type"
                    >
                      {%for room_type in room_dict.room_type%}
                      <option value="{{room_type}}">{{room_type}}</option>
                      {%endfor%}
                    </select>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="number_of_room_category">No of rooms for category type</label>
                    <input
                      type="number"
                      class="form-control"
                      id="number_of_room_category"
                      placeholder="No of rooms for category type"
                      name="number_of_room_category"
                      value="0"
                    />
                  </div>
                </div>

                <!-- Chidren and ault count -->

                <div class="col-6">
                  <div class="form-group">
                    <label for="Adult_count">No. of Adults</label>
                    <input
                      type="number"
                      class="form-control"
                      id="Adult_count"
                      placeholder="No of Adults--"
                      name="Adult_count"
                      value="0"
                    />
                  </div>
                </div>

                <div class="col-6">
                  <div class="form-group">
                    <label for="child_count">No of Children</label>
                    <input
                      type="number"
                      class="form-control"
                      id="child_count"
                      placeholder="No of Children"
                      name="child_count"
                      value="0"
                    />
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="old_child_sharing">No of old children sharing</label>
                    <input
                      type="number"
                      class="form-control"
                      id="old_child_sharing"
                      placeholder="No of old children sharing"
                      name="old_child_sharing"
                      value="0"
                    />
                  </div>
                </div>

                <div class="col-6">
                  <div class="form-group">
                    <label for="young_child_sharing">No of young children sharing</label>
                    <input
                      type="number"
                      class="form-control"
                      id="young_child_sharing"
                      placeholder="No of young children sharing"
                      name="young_child_sharing"
                      value="0"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Room Request End -->

          <button type="button" class="btn btn-primary" id="addRoombtn">Add Room</button>

          <div class="d-flex align-items-center justify-content-between">
            <button
              type="button"
              class="btn btn-primary mt-1 p-2 w-50 mr-3"
              data-toggle="modal"
              data-target="#exampleModalCenter"
              id="prev-down"
            >
              Preview / Download
            </button>
            <button type="submit" class="btn btn-primary mt-1 p-2 w-50">Submit</button>
          </div>
        </form>
        <p class="bg-warning text-dark p-3 w-100" id="err">Room Type Not Found</p>
      </div>

      <!-- End of Topbar -->
    </div>
    <!-- Button trigger modal -->

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModalCenter"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div
          class="modal-content"
          style="
            background-image: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
              url('https://img.myloview.com/posters/creative-black-cat-logo-design-vector-stock-400-176246869.jpg');
            background-position: center;
            background-size: contain;
          "
        >
          <div class="modal-header">
            <div>
              <h5 class="modal-title" id="mod_company">Company Name</h5>
              <p class="fs-4 fw-lighter d-block mb-0 pb-0" id="mod_address">123 sesame street</p>
              <img
                src="https://img.myloview.com/posters/creative-black-cat-logo-design-vector-stock-400-176246869.jpg"
                style="height: 80px; width: auto"
              />
            </div>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="d-flex justify-content-between px-3">
            <p class="text-lead fw-bold">
              Date:<span id="mod_date" class="text-lead fw-bold"> 22/June/2023</span>
            </p>
            <p class="text-lead fw-bold"><span id="mod_id"> #123ACV69</span></p>
          </div>

          <div class="modal-body">
            <h5 class="fw-bold display-6" id="mhead">Trip Summary</h5>
            <p class="py-0 my-1">
              Date: <span id="mod_fromdt">22/05/2023</span> To
              <span id="mod_todt">22/06/2023</span>
            </p>
            <p class="py-0 my-1">Total Adult travellers: <span id="mod_travAdult">5</span></p>
            <p class="py-0 my-1">Total Child travellers: <span id="mod_travChild">10</span></p>
            <p class="py-0 my-1">Total Rooms: <span id="mod_totalRoom">8</span></p>

            <!-- <div class="text-center py-1">
              <img
                src="https://img.myloview.com/posters/creative-black-cat-logo-design-vector-stock-400-176246869.jpg"
                style="height: 80px; width: auto"
              />
            </div> -->

            <table class="table table-striped">
              <thead class="bg-info text-light">
                <tr>
                  <th scope="col">Quantity</th>
                  <th scope="col">Item</th>
                  <th scope="col">KES</th>
                  <!-- <th scope="col">USD</th> -->
                </tr>
              </thead>
              <tbody id="datatable">
                <!-- <tr>
                  <th scope="row" id="row1">1</th>
                  <td id="row1col1"></td>
                  <td id="row1col2"></td>
                  <td id="row1col3"></td>
                </tr>
                <tr>
                  <th scope="row" id="row2">2</th>
                  <td id="row2col1"></td>
                  <td id="row2col2"></td>
                  <td id="row2col2"></td>
                </tr>
                <tr></tr> -->
              </tbody>
            </table>

            <table class="table" id="contract">
              <tr>
                <td>
                  Lorem ipsum dolor sit amet consectetur adipisicing elit. Et asperiores deserunt
                  vero nemo! Totam cum alias magni obcaecati iusto consequuntur earum excepturi
                  nesciunt porro? Accusamus neque dolorem quasi necessitatibus iste.
                </td>
              </tr>
            </table>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Download</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal ends -->

    <br />
    <!-- Footer -->
    <footer class="sticky-footer bg-white">
      <div class="container my-auto">
        <div class="copyright text-center my-auto">
          <span>Copyright &copy; Your Website 2021</span>
        </div>
      </div>
    </footer>
    <!-- End of Footer -->
  </div>
  <!-- End of Content Wrapper -->
</div>

<!-- Form Submmission Handling -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.2.3/jspdf.plugin.autotable.min.js"></script>

<!-- Add Room -->
<script>

      console.log()

    // Checking dates Availabilty Start=====>

      let dateArray= {{ available_dates|safe}}

      // console.log(dateArray)

      function checkDateRange() {
          const fromDate = document.getElementById("date_frm").value;
          const toDate = document.getElementById("date_to").value;


          // Compare the selected date range with each array element
          for (let i = 0; i < dateArray.length; i++) {
            const item = dateArray[i];
            const from = item.date_applicable_from;
            const to = item.date_applicable_to;

            if (fromDate >= from   && toDate <= to  ) {

              console.log("Date range matches array element:", item);
              document.getElementById("chkdates").style.display="none";
              return
              break
            }
            else{

              document.getElementById("chkdates").style.display="block";
             console.log("dates not avail")
            }
          }

        }
    // Checking dates Availabilty End=====>


        var roomData = [];
        var trooms = 0;
        function addRoom() {
          roomData = [];
          trooms += 1;
          // Get the container element for the room requests
          var roomContainer = document.getElementById("roomContainer");

          // Create a new div element for the room request
          var roomDiv = document.createElement("div");
          roomDiv.className = "room-request";

          // Clone the first room request div to create a new set of input fields
          var clonedRoomRequest = document.querySelector(".room-request:first-child").cloneNode(true);

          // Clear the values of the cloned input fields
          var clonedInputs = clonedRoomRequest.querySelectorAll("input, select");
          clonedInputs.forEach(function (input) {
            input.value = "";
            var inputId = input.getAttribute("id");
            var inputName = input.getAttribute("name");
            // Append a number to the id and name attributes
            input.setAttribute("id", inputId + roomContainer.childElementCount);
            input.setAttribute("name", inputName + roomContainer.childElementCount);
          });

          var clonedLabels = clonedRoomRequest.querySelectorAll("label");
          clonedLabels.forEach(function (label) {
            var labelFor = label.getAttribute("for");
            // Append a number to the for attribute
            label.setAttribute("for", labelFor + roomContainer.childElementCount);
          });

          // Append the cloned room request to the new div
          roomDiv.appendChild(clonedRoomRequest);

          // Append the new room div to the container
          roomContainer.appendChild(roomDiv);
          var room = {};
          for (x = 0; x <= trooms; x++) {
            let incount = x == 0 ? "" : x;

            room = {
              package_type: document.querySelector(`#package_type${incount}`).value,
              room_category: document.querySelector(`#room_category${incount}`).value,
              room_type: document.querySelector(`#room_type${incount}`).value,
              number_of_room_category: document.querySelector(`#number_of_room_category${incount}`).value,
              Adult_count: document.querySelector(`#Adult_count${incount}`).value,
              child_count: document.querySelector(`#child_count${incount}`).value,
              old_child_sharing: document.querySelector(`#old_child_sharing${incount}`).value,
              young_child_sharing: document.querySelector(`#young_child_sharing${incount}`).value,
              // Add other room data fields here
            };

            if (roomData.length < trooms + 1) {
              roomData = [...roomData, room];
            }
          }
          console.log(roomData);
          // Add the room data to the roomData array
        }

        // Attach the addRoom function to the "Add Room" button's click event
        var addButton = document.querySelector("#addRoombtn");
        addButton.addEventListener("click", addRoom);

        // Add Room Finish

        function handlesubmit(e) {
          e.preventDefault();
          console.log("here")
          document.getElementById('loader-form').style.display="block";

          roomData = [];
          var room = {};
          for (x = 0; x <= trooms; x++) {
            let incount = x == 0 ? "" : x;

            room = {
              package_type: document.querySelector(`#package_type${incount}`).value,
              room_category: document.querySelector(`#room_category${incount}`).value,
              room_type: document.querySelector(`#room_type${incount}`).value,
              number_of_room_category: document.querySelector(`#number_of_room_category${incount}`).value,
              Adult_count: document.querySelector(`#Adult_count${incount}`).value,
              child_count: document.querySelector(`#child_count${incount}`).value,
              old_child_sharing: document.querySelector(`#old_child_sharing${incount}`).value,
              young_child_sharing: document.querySelector(`#young_child_sharing${incount}`).value,
              // Add other room data fields here
            };

            if (roomData.length < trooms + 1) {
              roomData = [...roomData, room];
            }
          }

          const FD = new FormData();
          let formData = new FormData(document.getElementById("quote")); //formdata object

          for (const [name, value] of formData.entries()) {
            if (
              !name.includes("Adult_count") &&
              !name.includes("child_count") &&
              !name.includes("number_of_room_category") &&
              !name.includes("old_child_sharing") &&
              !name.includes("package_type") &&
              !name.includes("room_category") &&
              !name.includes("room_type") &&
              !name.includes("young_child_sharing")
            ) {
              FD.append(name, value);
            }
          }

          // FD.append('age', 20);
          const config = {
            headers: { "content-type": "multipart/form-data" },
          };

          let formDataJson = {};
          for (let [key, value] of FD.entries()) {
            formDataJson[key] = value;
          }

          formDataJson = { ...formDataJson, roomData };
          // Print the JSON string
          console.log(formDataJson);
          console.log(formDataJson.hotel_name);
          let totalRooms = 0;
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

              document.getElementById('loader-form').style.display="none";
              document.getElementById('prev-down').style.display="block";


              console.log(this.responseText);
              let fdata = JSON.parse(this.responseText);
              console.log(fdata);
              let tdate = new Date();
              document.getElementById("mod_company").innerHTML = fdata.hotel_name;
              document.getElementById("mod_address").innerHTML = fdata.area + "," + fdata.country;
              document.getElementById("mod_date").innerHTML = tdate.toLocaleDateString();
              document.getElementById("mod_fromdt").innerHTML = fdata.date_frm;
              document.getElementById("mod_todt").innerHTML = fdata.date_to;
              document.getElementById("mod_travAdult").innerHTML = fdata.total_adult_travellers;
              document.getElementById("mod_travChild").innerHTML = fdata.total_child_travellers;
              fdata.roomData.map((ini) => {
                totalRooms += ini.total_rooms;
              });
              document.getElementById("mod_totalRoom").innerHTML = fdata.total_rooms;
              // document.getElementById("row1col1").innerHTML =
              //   fdata.hotel_name + ", " + fdata.package_type;
              // document.getElementById("row1col3").innerHTML = fdata.adult_res ;

              // // Row 2

              // document.getElementById("row2col1").innerHTML =
              //   fdata.hotel_name + ", " + fdata.package_type;
              // document.getElementById("row2col2").innerHTML = fdata.adult_res + fdata.adult_res;

              let totalMoney = 0;
              fdata.roomData.map((ini,i) => {


                let tr = document.createElement("tr");
                let td1 = document.createElement("td");
                td1.innerHTML = ini.no_of_rooms_for_category_type;
                let td2 = document.createElement("td");
                td2.innerHTML = fdata.hotel_name + ", " + ini.package_type + ", " + ini.room_category;
                let td3 = document.createElement("td");
                td3.innerHTML = fdata.adult_res;
                // let td4 = document.createElement("td");
                // td4.innerHTML = fdata.adult_res;

                tr.appendChild(td1);
                tr.appendChild(td2);
                tr.appendChild(td3);
                // tr.appendChild(td4);

                document.getElementById("datatable").appendChild(tr);

                let ttr=document.createElement("tr");
                let ttd1 = document.createElement("td");
                ttd1.innerHTML = "Total";
                let ttd2 = document.createElement("td");
                ttd2.innerHTML = "";
                let ttd3 = document.createElement("td");
                ttd3.innerHTML = fdata.adult_res;
                // let ttd4 = document.createElement("td");
                // td4.innerHTML = fdata.adult_res;

                ttr.appendChild(ttd1);
                ttr.appendChild(ttd2);
                ttr.appendChild(ttd3);
                console.log(fdata.roomData.length)
                console.log(i)
                if(fdata.roomData.length==i+1){ console.log("here"); document.getElementById("datatable").appendChild(ttr);}
              });
            }

            else{
              document.getElementById("err").style.display="block"
              document.getElementById('loader-form').style.display="none";

            }
          };
          xhttp.open("POST", "http://127.0.0.1:8000/get_form_data/");
          xhttp.send(JSON.stringify(formDataJson));
        }

        function downloadModalData() {
          // Create a new jsPDF instance
          var doc = new jsPDF();
            // Water Mark start

  var backgroundImage = new Image();
  backgroundImage.src =
  "{%static 'img/watermark.jpg' %}"
  function addWatermark() {
    var imgWidth = doc.internal.pageSize.getWidth();
    var imgHeight = doc.internal.pageSize.getHeight();

    doc.addImage(backgroundImage, '', 0, 0, imgWidth, imgHeight-30);
  }
  addWatermark();
  // Water mark end


          // Get the modal content
          var modalContent = document.getElementById("exampleModalCenter");

          // Get the modal title and address
          var companyName = modalContent.querySelector("#mod_company");
          var address = modalContent.querySelector("#mod_address");
          var mehad = modalContent.querySelector("#mhead");

          // Get the date and trip summary details
          var date = modalContent.querySelector("#mod_date").innerText;
          var modid = modalContent.querySelector("#mod_id").innerText;
          var fromDate = modalContent.querySelector("#mod_fromdt").innerText;
          var toDate = modalContent.querySelector("#mod_todt").innerText;
          var adultTravellers = modalContent.querySelector("#mod_travAdult").innerText;
          var childTravellers = modalContent.querySelector("#mod_travChild").innerText;
          var totalRooms = modalContent.querySelector("#mod_totalRoom").innerText;

          // Set the document content
          doc.setFontSize(12);
          doc.fromHTML(companyName, 15, 25);
          doc.fromHTML(address, 15, 35);
          var imgData = new Image();
          imgData.src = "{%static 'img/dummylogo.jpg' %}";
          doc.addImage(imgData, "", 15, 45, 20, 20);

          doc.fromHTML("Date: " + date, 15, 60);
          doc.fromHTML(mehad, 15, 80);
          doc.fromHTML("Date: " + fromDate + " To " + toDate, 15, 90);
          doc.fromHTML("Total Adult travellers: " + adultTravellers, 15, 100);
          doc.fromHTML("Total Child travellers: " + childTravellers, 15, 110);
          doc.fromHTML("Total Rooms: " + totalRooms, 15, 120);



          // Get the table data
          var table = modalContent.querySelector("table");
          var contra = modalContent.querySelector("#contract");

          // Generate the table using autoTable plugin
          var options = {
            startY: 140, // Set the initial y-position for the table
            margin: { top: 10 },
            didDrawPage: function (data) {
              // Add new page if the table exceeds the page height
              if (data.startY + data.table.height > data.page.height) {
                doc.addPage();
              }
            },
          };

          doc.autoTable({
            html: table,
            startY: options.startY,
            margin: options.margin,
          });
          doc.autoTable({ html: contra, startY: doc.autoTable.previous.finalY + 10 });

          // Save the document
          doc.save("modal_data.pdf");
        }
        var downloadButton = document.querySelector("#exampleModalCenter .modal-footer .btn-primary");
        downloadButton.addEventListener("click", downloadModalData);
</script>

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
  var myJson = {{jsonData | safe}}
  $.each(myJson.country, function (index, value) {
      var country_id;
      var state_id;
      var city_id;

          $("#country").append('<option rel="' + index + '" value="'+value.id+'">'+value.name+'</option>');

          $("#country").change(function () {
              $("#state, #hotel_name").find("option:gt(0)").remove();
              $("#state").find("option:first").text("Loading...");

              country_id = $(this).find('option:selected').attr('rel');
              console.log("Country INDEX : " + country_id);

              $("#state").find("option:first").remove();
              $.each(myJson.country[country_id].states, function (index1, value1) {
                  $("#state").append('<option rel="' + index1 + '" value="'+value1.id+'">'+value1.name+'</option>');
              });

          });


          $("#state").change(function () {
              $("#hotel_name").find("option:gt(0)").remove();
              $("#hotel_name").find("option:first").text("Loading...");

              state_id = $(this).find('option:selected').attr('rel');
              console.log("State INDEX : " + state_id);

              $("#hotel_name").find("option:first").remove();
              $.each(myJson.country[country_id].states[state_id].hotels, function (index2, value2) {
                  //$("#hotel_name").find("option:first").text("");
                  $("#hotel_name").append('<option rel="' + index2 + '" value="'+value2.id+'">'+value2.name+'</option>');
              });


          });

  });
</script>

{%endblock body%}
